\subsection{Análise descritiva}

\subsubsection{Condição do empréstimo}

A variável "Condição do empréstimo" é a variável reposta desse estudo, como foi definido anteriormente.
Com isso temos o seguinte comportamento dessa variável:

\begin{table}[H]
  \centering
  \begin{tabular}{lcc}
    \hline
    \textbf{Condição do empréstimo} & \textbf{Número de observações} & \textbf{Frequência relativa} \\ \hline
    Empréstimo bom  & 819950 & 92,4\% \\
    Empréstimo ruim & 67429  & 7,59\% \\ \hline
  \end{tabular}
  \caption{Número de observação em cada categoria da variável resposta}
  \label{tab:freq_var_res}
\end{table}

A Tabela \ref{tab:freq_var_res} mostra a distribuição da variável "Condição do empréstimo". Uma variável composta majoritariamente 
por observações do tipo "Empréstimo bom", onde a mesma está presente em mais de 90\% das observações na base de dados, mostrando
que a cada 12 empréstimos rotulados como "bons", existe 1 rotulado como "ruim". 

\subsubsection{Relação entre as covariáveis e a variável resposta}

% boxplot
\begin{figure}[H]
  \centering
  \subImagem{imagens/exploratoria/quantidade_emprestimo.jpg}{Valor do empréstimo}
  \vspace{.5cm}
  \subImagem{imagens/exploratoria/duracao_emprestimo.jpg}{Tempo de emprego (em anos)}
  \vspace{.5cm}
  \subImagem{imagens/exploratoria/parcela.jpg}{Valor da parcela do emprésitmo}
 \subImagem{imagens/exploratoria/renda_anual.jpg}{Renda anual (em dólar)}
  
  \label{fig:exp_boxplot1}
  \caption{Variáveis explicativas em relação à condição do empréstimo}
  
\end{figure}

O comportamento da variável resposta nas Figuras \ref{imagens/exploratoria/quantidade_emprestimo.jpg} 
e \ref{imagens/exploratoria/parcela.jpg} demonstrou semelhanças, onde, em ambos os casos,
não foi evidenciada uma clara diferença entre o valor do empréstimo e o valor da parcela em relação às
categorias da variável resposta. A Figura \ref{imagens/exploratoria/duracao_emprestimo.jpg} 
também apresenta um comportamento semelhante entre as classes
"Empréstimo ruim" e "Empréstimo bom", mas com um detalhe: a mediana do tempo de trabalho dos clientes rotulados 
como "Empréstimo ruim" foi inferior em comparação ao outro caso. Por fim, a Figura \ref{imagens/exploratoria/renda_anual.jpg} 
indica que clientes 
com uma renda anual elevada tendem a ser categorizados como "Empréstimo bom".


\begin{figure}[H]
  \centering
  \subImagem{imagens/exploratoria/taxa_juros.jpg}{Taxa de juros do empréstimo}
  \vspace{.5cm}
  \subImagem{imagens/exploratoria/dti.jpg}{Razão entre a dívida e o salário do cliente}
  \vspace{.5cm}
  \subImagem{imagens/exploratoria/pagamento_bruto.jpg}{Valor bruto do emprétimo pago}
 \subImagem{imagens/exploratoria/pagamento_liquido.jpg}{Valor líquido do emprétimo pago}
 \caption{Variáveis explicativas em relação à condição do empréstimo}
  
 \label{fig:exp_boxplot2}
\end{figure}

A Figura \ref{imagens/exploratoria/taxa_juros.jpg} evidencia uma relação significativa entre taxas de juros elevadas e empréstimos 
considerados ruins. A Figura \ref{imagens/exploratoria/dti.jpg} complementa a informação fornecida pela 
Figura \ref{imagens/exploratoria/renda_anual.jpg},
indicando que clientes com renda mais elevada tendem a cumprir adequadamente com seus pagamentos.
As Figuras \ref{imagens/exploratoria/pagamento_bruto.jpg} e  \ref{imagens/exploratoria/pagamento_liquido.jpg} 
seguem padrões semelhantes, sugerindo que clientes que quitaram a 
maior parte do empréstimo são frequentemente rotulados como bons pagadores.

%TODO: tentar mostrar os valores absolutos no gráfico de barras
% barras
\begin{figure}[H]
    \centering
    \subImagem{imagens/exploratoria/finalidade.pdf}{Finalidade do empréstimo}
    \vspace{.5cm}
    \subImagem{imagens/exploratoria/categoria_renda.pdf}{Renda categorizada}
    \vspace{.5cm}
    \subImagem{imagens/exploratoria/grau.pdf}{Risco do empréstimo}
    \subImagem{imagens/exploratoria/tipo_aplicacao.pdf}{Tipo de aplicação do empréstimo}  
    \subImagemSemLegenda{imagens/exploratoria/legenda.pdf}
    
    \label{fig:exp_bar1}
    \caption{Variáveis explicativas em relação à condição do empréstimo}
\end{figure}


A Figura \ref{imagens/exploratoria/finalidade.pdf} ilustra que as categorias da variável "Finalidade" 
seguem a proporção natural da condição do empréstimo,
conforme indicado na Tabela de Condição do Empréstimo. Na Figura \ref{imagens/exploratoria/categoria_renda.pdf}, 
as categorias "Alta" e "Média"
exibem proporções menores de empréstimos ruins em comparação com a categoria "Baixa", que apresenta uma proporção de quase 10\% 
de empréstimos ruins. A Figura \ref{imagens/exploratoria/grau.pdf} revela um padrão de "cascata", indicando que à medida que o risco do 
empréstimo aumenta, a proporção de empréstimos ruins nas últimas categorias também aumenta, 
sendo a categoria G a mais afetada, com quase 25\% de empréstimos classificados como ruins. 
Na Figura \ref{imagens/exploratoria/tipo_aplicacao.pdf}, a categoria "Empréstimo conjunto" 
não registrou observações de empréstimos ruins, 
concentrando a maioria desses empréstimos na categoria "Empréstimo individual".


\begin{figure}[H]
  \centering
  \subImagem{imagens/exploratoria/pagamentos_juros.pdf}{Tipo de juros aplicado no empréstimo}
  \vspace{.5cm}
  \subImagem{imagens/exploratoria/regiao.pdf}{Região que o tomador do empréstimo vive}
  \vspace{.5cm}
  \subImagem{imagens/exploratoria/propriedade_casa.pdf}{Tipo de propriedade do tomador do empréstimo}
  \subImagem{imagens/exploratoria/prazo.pdf}{Duração do empréstimo em meses (36 ou 60 meses)}
  \subImagemSemLegenda{imagens/exploratoria/legenda.pdf}

  \caption{Variáveis explicativas em relação à condição do empréstimo}
  \label{fig:exp_bar2}
\end{figure}

Na Figura \ref{fig:exp_bar2}, o gráfico \ref{imagens/exploratoria/pagamentos_juros.pdf} 
evidencia que empréstimos obtidos sob juros compostos possuem uma proporção 
mais elevada de rotulações ruins em comparação com empréstimos sob juros simples. As Figuras \ref{imagens/exploratoria/regiao.pdf} 
e \ref{imagens/exploratoria/propriedade_casa.pdf}
destacam uma proporção natural refletida pela distribuição das categorias da variável resposta, 
conforme apresentado na Tabela \ref{tab:freq_var_res}. Já a Figura \ref{imagens/exploratoria/prazo.pdf} 
revela uma proporção mais significativa
de empréstimos ruins quando estes tendem a demorar mais para serem pagos.

\begin{table}[H]
  \centering
  \begin{tabular}{lc}
    \hline
    \textbf{Covariáveis} & \mbox{\textbf{Coeficiente de correlação}} \\ 
    \hline
    Tempo de trabalho & -0.02 \\ 
    Renda anual & -0.03 \\ 
    Valor do empréstimo & 0.00 \\ 
    Taxa de juros & 0.18 \\ 
    DTI & 0.01 \\ 
    Valor bruto pago & -0.04 \\ 
    Valor liquido pago & -0.10 \\ 
    Parcela & -0.01 \\ 
    Duração do empréstimo &  0.01 \\
    \hline
  \end{tabular}
  \caption{Valores do coeficiente de Pearson entre as covariáveis e a variável resposta}
  \label{tab:coef_corr}
  \end{table}

A partir da análise da Tabela \ref{tab:coef_corr}, nota-se que as correlações entre as 
variáveis explicativas e a variável resposta são de baixa magnitude. Os coeficientes 
calculados indicam uma relação linear fraca ou inexistente entre essas variáveis. 
Esses resultados sugerem que outros fatores ou relações não lineares podem estar desempenhando 
um papel mais significativo na explicação da variabilidade na variável resposta.
  
\begin{table}[H]
  \centering
  \begin{tabular}{lc}
    \hline
    \textbf{Covariáveis} & \mbox{\textbf{Coeficiente de contingência}} \\ 
    \hline
    Tipo de residência & 0.04 \\ 
    Tipo de aplicação & 0.01 \\ 
    Finalidade & 0.03 \\ 
    Tipo de juros & 0.14 \\ 
    Risco & 0.15 \\ 
    Região & 0.01 \\ 
    Prazo & 0.04 \\
    Renda &  0.04 \\
     \hline
  \end{tabular}
  \caption{Valores do coeficiente de contingência entre as covariáveis e a variável resposta}
  \label{tab:coef_cont}
\end{table}

Ao analisar a Tabela \ref{tab:coef_cont}, nota-se que a maioria dos coeficientes de contingência entre as 
covariáveis e a variável resposta são próximos de zero. Destaca-se que a variável "Risco"
exibe o maior valor de associação, atingindo 0.15. Entretanto, é importante ressaltar que esse valor
ainda é relativamente baixo. Os coeficientes sugerem, em geral, uma falta de associação significativa 
entre as covariáveis mencionadas e a variável resposta.


\subsection{Regressão logística}

Como visto na Equação \ref{eq:model_logistic}, a fórmula do modelo logístico é dada por:

\begin{equation}
  P(Y=1| x_1, x_2, ..., x_k) = \frac{1}{1 + e^{-(\beta_0 + x_{1}\beta_1 + x_{2}\beta_2 + \ldots + x_{k}\beta_k)}}
\end{equation}

E com base nela os seguintes resultados foram encontrados:


\begin{table}[H]
\centering
\begin{tabular}{lcc}
  \toprule
    \textbf{Covariáveis} & \textbf{Coeficientes} &  \textbf{Erro padrão} \\
  \midrule
        Valor líquido pago & -4.733 &  0.034 \\
        Valor bruto pago &  3.321 &  0.028 \\
        Tipo de aplicação & -1.848 &  0.106 \\
        Taxa de juros &  1.412 &  1.412 \\
        Valor do empréstimo & -1.406 &  0.039 \\
        Risco & -1.049 &  0.014 \\
        Tipo de juros & -0.462 &  -0.462  \\
        Prazo & -0.203 &  0.028 \\
        Renda anual & -0.195 &  0.010 \\
        DTI & -0.151 &  0.011 \\
        Renda categorizada & -0.111 &  0.015 \\
        Tempo de trabalho & -0.061 &  0.009 \\
        Região &  0.038 &  0.003\\
        Duração do empréstimo &  0.033 &  0.009 \\
        Tipo de residência &  0.019 &  0.003 \\
        Finalidade &  0.019 &  0.002  \\
        Parcela &  0.005 &  0.000  \\
  \bottomrule
\end{tabular}
\caption{Estimativa dos coeficientes do modelo logístico e o erro padrão associado}
\label{tab:result_model_logist}
\end{table}

Ao analisar os resultados apresentados na Tabela \ref{tab:result_model_logist}, fica evidente
que as variáveis "Valor líquido pago" e "Valor bruto pago" exercem uma influência significativa no valor final de $P(Y=1)$.
Essas duas variáveis estão diretamente associadas à quantia do empréstimo que o cliente já quitou, 
indicando sua relevância na predição do resultado. Ao calcular a Razão de chances dessas duas variáveis, temos que:


\begin{itemize}
  \item "Valor líquido pago": apresenta um RC de 0.008, o que sugere que, mantendo todas as outras variáveis constantes, a chance de o empréstimo ser classificado como bom é 125 vezes maior do que ser classificado como ruim.
  \item "Valor bruto pago": exibe um RC de 27.68, indicando que, ao manter todas as outras variáveis constantes, a chance de o empréstimo ser classificado como ruim é 27 vezes maior do que ser classificado como bom.
\end{itemize}


\imagem{imagens/resultados/report_model_logistico.png}{Matrix de confusão do modelo logístico}

Visualizando os dados da Figura \ref{fig:imagens/resultados/report_model_logistico.png} é possível analisar 
os resultados do modelo logístico no conjunto de teste. O conjunto de teste apresenta uma distribuição da variável 
resposta de com mais de 92\% dos casos como um empréstimo bom, e o restante como o empréstimo ruim.
%TODO: falar dos falsos positivos e falsos negativos


\begin{table}[H]
\centering
\begin{tabular}{lcccc}
  \hline
                &    \textbf{Precisão} & \textbf{Recall}    &   \textbf{F1-Score} &  \textbf{Tamanho da amostra} \\
  \hline
   0               &    0.928 & 0.995  &   0.961 & 163990        \\
   1               &    0.536 & 0.062 &   0.111 & 13486        \\
   Média macro     &    0.732 & 0.528  &   0.535 & 177476        \\
   Média ponderada &    0.898 & 0.925  &   0.896 & 177476        \\
   \hline
   Acurácia     &             &           &    &  0.925\\

  \hline
\end{tabular}
\caption{Report do modelo logístico}
\label{tab:report_logist_model}
\end{table}


Com base nos dados apresentados na Tabela \ref{tab:report_logist_model}
e na Figura \ref{fig:imagens/resultados/report_model_logistico.png},
observamos que o modelo exibe uma acurácia elevada. Ele é capaz de fazer 
previsões precisas na maioria dos casos, alcançando uma taxa de 92,46\% 
de classificações corretas no conjunto de teste. No entanto, 
é crucial destacar que essa elevada acurácia é influenciada pela proporção
significativa de casos onde o empréstimo é rotulado como "bom", presente 
em mais de 92\% dos dados de teste. Como resultado, o modelo tende a
classificar uma parte considerável dos dados como "0", refletindo a
influência dessa distribuição desigual na estimação dos parâmetros do modelo logístico. 


Ao examinarmos a precisão do modelo, observamos uma taxa de acerto de 73\%
nas previsões em comparação com as rótulos reais do conjunto de teste. 
É importante ressaltar a notável precisão na categoria "Empréstimo bom", atingindo quase 92\%. 
No entanto, vale destacar que esse valor elevado está correlacionado ao desequilíbrio nos dados,
onde a classe "Empréstimo bom" é predominante.

Ao avaliar o recall do modelo logístico, observamos, em média,
valores mais baixos em comparação com a precisão. O recall médio é de 52,8\%, 
indicando que, ao analisar as porcentagens das rótulos reais, o modelo conseguiu 
acertar um pouco mais da metade delas. Esse desempenho é atribuído ao alto número 
de falsos negativos no modelo, visto que, ao considerar o total de "Empréstimos ruins" (13.486),
 o modelo acertou apenas 834 desses casos.

O F1-score acaba refletindo a real situação do modelo, pois ele balanceia os bons resultados
apresentados pela precisão com os resultados ruins do recall. O F1-score médio apresentado foi
de 52,57\%.

A avaliação global do modelo logístico revela um viés significativo, amplificado pelo desequilíbrio nos dados.
Embora o modelo tenha alcançado uma taxa geral de acerto de 92\%, sua incapacidade de distinguir
adequadamente entre "Empréstimos bons" e "Empréstimos ruins" é evidente. 
Este desempenho inferior sugere limitações na capacidade do modelo de generalizar e
discriminar efetivamente entre as categorias, indicando a necessidade de refinamentos ou 
considerações adicionais para melhorar sua robustez.


\subsection{Rede neural}

Esse seção vai abordar os resultados obtidos pelo modelo de rede neural.


\imagem{imagens/resultados/report_model_neural_ganhador.png}{Matrix de confusão da rede neural}


A Figura \ref{fig:imagens/resultados/report_model_neural_ganhador.png} estima que aproximadamente 
12\% da amostra de teste estimada pelo modelo consiste em empréstimos ruins, uma estimativa ligeiramente distante 
da distribuição real apresentada na Tabela \ref{tab:freq_var_res}. No entanto, esse resultado 
sugere que o modelo conseguiu generalizar seus resultados, quando comparado com o modelo logístico. 
Por outro lado, o número de empréstimos
classificados como "0" diminuiu, representando mais de 84\% da amostra de teste. Esse ajuste 
parece ter aumentado o número de Falsos Positivos, provavelmente devido à tentativa do modelo
em variabilizar os resultados.


\begin{table}[H]
  \centering
\begin{tabular}{lcccc}
  \hline
  &    \textbf{Precisão} & \textbf{Recall}    &   \textbf{F1-Score} &  \textbf{Tamanho da amostra} \\
  \hline
   0                &    0.954 & 0.904 &   0.929 & 163990        \\
   1                &    0.291 & 0.478 &   0.362 & 13486         \\
   Média macro      &    0.622 & 0.691 &   0.645 & 177476        \\
   Média ponderada  &    0.904 & 0.872 &   0.886 & 177476        \\ \hline
   Acurácia         &          &       &         & 0.872      \\
  \hline
\end{tabular}
\caption{Report da rede neural}
\label{tab:report_model_neural_ganhador}
\end{table}


Os resultados apresentados na Tabela \ref{tab:report_model_neural_ganhador} indicam um desempenho satisfatório
do modelo, especialmente em termos de acurácia e métricas avaliadas para a classe "0". 
Contudo, ao comparar esses resultados com as métricas da classe "1", percebe-se que o modelo ainda
é influenciado pelo elevado número de observações na classe "0". Entretanto, uma análise mais detalhada 
do Recall da classe "1" revela que o modelo conseguiu reduzir significativamente o número de Falsos Negativos,
identificando corretamente quase metade dos empréstimos considerados ruins na base original. Essa melhoria 
no Recall da classe "1" resultou em uma precisão inferior para essa classe, refletindo que menos de 30\% 
das previsões do modelo foram corretas nesse contexto, como evidenciado na Tabela \ref{tab:report_model_neural_ganhador}.


Em termos gerais, as decisões relacionadas à arquitetura do modelo, seus hiperparâmetros, 
estratégia de treinamento e outros fatores contribuíram para que o modelo de redes neurais realizasse previsões
de alta qualidade, não se limitando apenas ao desbalanceamento dos dados. Os resultados obtidos pelo modelo de redes
neurais foram satisfatórios devido à eficácia da arquitetura da rede. Portanto, buscar aprimorar ainda mais essa 
arquitetura pode ser uma abordagem promissora na busca por resultados ainda melhores.

\subsection{Interpretação da rede neural}


Após definir o modelo de rede neural e examinar seus resultados, esta seção aborda a interpretação do modelo. 
Para isso, foram construídos gráficos com base nos resultados do SHAP, destacando as variáveis de maior importância
 no resultado final. Utilizando uma amostra de 80 observações, o valor de SHAP foi calculado para cada observação, 
 permitindo uma análise tanto individual quanto conjunta dessa amostra.

\imagem{imagens/shap/media_shap.png}{Média absoluta dos valores de shap}


O Gráfico \ref{fig:imagens/shap/media_shap.png} exibe a média absoluta dos valores de SHAP para cada variável nas
80 observações consideradas. Essa representação oferece insights sobre quais variáveis o modelo considerou mais
relevantes durante as predições, destacando a magnitude da contribuição de cada variável. Vale notar que, por 
se tratar de valores absolutos, o gráfico não proporciona informações sobre se a contribuição de cada variável
é positiva ou negativa. Entretanto, os próximos gráficos irão elucidar essa questão ao detalhar a contribuição 
específica de cada variável.

Ao analisar cada variável no gráfico, destaca-se que "Total líquido pago" e "Total bruto pago" são as que mais
contribuem para o resultado final do modelo. O gráfico enfatiza a relevância de nove variáveis, omitindo 
o restante devido à sua baixa contribuição. Ao observar as variáveis omitidas, percebe-se que, somadas, 
suas contribuições aproximam-se de 0.01, evidenciando a sua baixa influência no resultado final do modelo de rede neural.

Os próximos graficos proporcionam a visualização dos valores SHAP para cada variável em observações individuais.
O gráfico também revela os valores específicos utilizados em cada variável. A apresentação de quatro figuras distintas tem
como objetivo compreender como o valor SHAP é atribuído em quatro cenários distintos que surgem em problemas de classificação binária.

Os 2 primeiros gráficos mostram casos onde o modelo acertou suas predições, tanto para casos de "Empréstimos ruins" quanto para 
"Empréstimos bons".

\imagem{imagens/shap/shap_plot_verdadeiro_positivo.png}{Valor de SHAP para uma observação do tipo Verdadeiro Positivo}

Na Figura \ref{fig:imagens/shap/shap_plot_verdadeiro_positivo.png}, cenário em que o modelo acertou a classificação de 
um empréstimo como ruim, observa-se que as variáveis que mais contribuíram foram as mesmas observadas na Figura \ref{fig:imagens/shap/media_shap.png}, 
comportamento esse que vai prevalecer nos demais casos.
Ao analisar os valores dessas duas variáveis, nota-se que, para esse cliente específico, ainda resta um montante significativo do empréstimo a ser pago, 
totalizando quase 90\% do valor líquido pendente e quase 50\% do valor bruto pendente. Uma diferença muito grande
entre o valor do empréstimo e o que falta a ser pago pode ser um dos fatores que está ocasionando a rotulação de observações
como "Empréstimos ruins". 

\imagem{imagens/shap/shap_plot_verdadeiro_negativo.png}{Valor de SHAP para uma observação do tipo Verdadeiro Negativo}

Ao analisar a Figura \ref{fig:imagens/shap/shap_plot_verdadeiro_negativo.png}, que representa o cenário em que o modelo
acertou a rotulação de um empréstimo bom, nota-se um valor final bem próximo de  0. Indícios 
de que o modelo teve mais confiança ao realizar essa predição. 
Ao analisar os valores de cada variável, é possível perceber que o cliente já está finalizando ou finalizou o empréstimo,
dado que as variáveis de pagamento do empréstimo chegaram no valor real do empréstimo.


Analisando as Figuras \ref{fig:imagens/shap/shap_plot_verdadeiro_positivo.png} e \ref{fig:imagens/shap/shap_plot_verdadeiro_negativo.png},
é possível observar a 
flexibilidade do modelo em lidar com diferentes valores da mesma variável. Quando o modelo encontra valores que indicam um 
empréstimo ruim, atribui valores positivos para a contribuição das variáveis, aproximando-as de 1. Da mesma forma, para 
empréstimos bons, o modelo adiciona uma contribuição negativa, direcionando o resultado para 0. Isso demonstra como o modelo 
responde de forma dinâmica às variações nos valores das variáveis.


\imagem{imagens/shap/shap_plot_falso_positivo.png}{Valor de SHAP para uma observação do tipo Falso Positivo}


Ao analisar um exemplo em que o modelo erroneamente classifica um "Empréstimo ruim", conforme ilustrado na Figura
 \ref{fig:imagens/shap/shap_plot_falso_positivo.png}, destacam-se as características já discutidas nas interpretações
  anteriores. O resultado do modelo foi muito próximo do limiar de decisão, que é 0,5, indicando que o modelo teve 
  alguma indecisão ao realizar a predição desse caso.


\imagem{imagens/shap/shap_plot_falso_negativo.png}{Valor de SHAP para uma observação do tipo Falso Negativo}

Observando a Figura \ref{fig:imagens/shap/shap_plot_falso_negativo.png}, que retrata um cenário em que o modelo
 classifica de forma equivocada um "Empréstimo bom", é possível perceber um comportamento de divergência entre 
 as variáveis que mais contribuem com o resultado do modelo. Esse padrão de divergência não foi observado nos
  casos anteriores, e pode ter influenciado o modelo a realizar uma predição incorreta.


\imagem{imagens/shap/shap_geral.png}{Valores de shap para as 80 observações utilizadas}


A Figura \ref{fig:imagens/shap/shap_geral.png} apresenta o comportamento do valor de SHAP para cada variável
entre as 80 observações utilizadas no experimento. No gráfico, o eixo x refere-se à distribuição do valor de SHAP,
enquanto o eixo y representa cada variável. O eixo das cores ilustra a distribuição dos valores da variável, 
sendo que cores mais quentes indicam valores maiores e cores mais frias indicam valores menores.

Ao analisar as variáveis que mais influenciam o resultado do modelo, observa-se uma distribuição mais dispersa no eixo x.
 Ao focar nas duas variáveis de maior contribuição, nota-se um comportamento heterogêneo dos valores em comparação com 
 os valores de SHAP. Para a primeira variável, elevados valores tendem a impactar negativamente no resultado do modelo, 
 enquanto a segunda variável apresenta o comportamento oposto, com valores mais baixos contribuindo negativamente no
  resultado do modelo.


\imagem{imagens/shap/force_plot.png}{Gráfico de força em uma observação}


A Figura \ref{fig:imagens/shap/force_plot.png} ilustra a "força" de contribuição de cada variável no modelo.
 Este gráfico proporciona uma visão clara das variáveis que tiveram impacto positivo e negativo no resultado final.
  Cada barra representa a intensidade da contribuição de uma variável específica, sendo que aquelas com maior 
  influência concentram-se no centro, enquanto as de menor influência ficam nas extremidades. 
  A figura é centrada no valor final predito pelo modelo, que, neste caso, é observado como 0.3, 
  indicando um empréstimo classificado como bom.

\imagem{imagens/shap/force_plot_multiples_vars.png}{Gráfico de força para múltiplas observações}


A Figura \ref{fig:imagens/shap/force_plot_multiples_vars.png} é uma generalização da Figura \ref{fig:imagens/shap/force_plot.png},
considerando as 80 observações. Este gráfico é um recorte obtido de uma visualização dinâmica gerada pelo pacote SHAP.
 Devido à natureza dinâmica do gráfico original, ao transformá-lo em uma imagem estática, parte de sua capacidade de 
 representação é limitada. No entanto, é possível observar alguns padrões nesse recorte. Por exemplo, cores mais 
 quentes indicam contribuições positivas quando o modelo faz predições próximas de 1, com tons de vermelho 
 representando adições das variáveis ao resultado. Da mesma forma, cores mais frias indicam contribuições 
 negativas quando o modelo faz predições próximas de 0.


\subsection{Benchmark entre regressão logística e redes neurais }

Ao obter interpretações do modelo de redes neurais, abre-se a possibilidade de realizar comparações 
entre os modelos de regressão logística e redes neurais no âmbito interpretativo. Até recentemente, 
essa capacidade de interpretação estava exclusivamente associada ao modelo logístico em comparação com o modelo de redes neurais.
Essa análise comparativa se soma às comparações já realizadas entre os modelos, englobando aspectos como arquitetura,
tempo de treinamento,
tempo de predição e os resultados gerados por ambos os modelos. Os resultados abaixo evidenciam essas comparações.

\subsubsection{Complexidade da arquitetura}

\begin{table}[H]
  \centering
  \begin{tabular}{lc}
  \hline
  \textbf{Modelo} & \textbf{Número de parâmetros} \\ \hline
  Regressão Logística & 18 \\ 
  Rede Neural & 151233 \\ \hline
  \end{tabular}
  \caption{Número de parâmetros nos modelos}
  \label{table:model_parameters}
\end{table}

Ao examinar a Tabela \ref{table:model_parameters}, destaca-se a significativa disparidade na
complexidade entre os modelos. Enquanto o modelo logístico possui apenas um parâmetro para cada covariável,
a rede neural apresenta mais de 8400 parâmetros para cada parâmetro do modelo logístico,  
sendo esses distribuídos nos neurônios e camadas da rede.

\subsubsection{Resultado dos modelos}

\begin{table}[H]
  \centering
  \begin{tabular}{lcc}
    \hline
    \textbf{Métricas} & \textbf{Regressão logística} & \textbf{Rede neural} \\
    \hline
    Falsos Positivos   & 721                     & 15703 \\
    Falsos Negativos   & 12652                   & 7039 \\
    \hline
  \end{tabular}
  \caption{Comparação dos resultados de Falsos Positivos e Falsos Negativos}
  \label{tab:false_positives_negatives}
\end{table}

Ao analisar os casos em que os modelos cometeram erros, conforme apresentado na Tabela \ref{tab:false_positives_negatives}, 
é evidente que, em geral, o modelo logístico cometeu menos erros do que a rede neural. O modelo logístico registrou um total 
de pouco mais de 13 mil classificações incorretas, enquanto a rede neural teve mais de 18 mil erros.
 No entanto, é importante destacar que a rede neural cometeu menos erros nos casos de Falsos Negativos.
  Esse cenário é significativo no contexto de empréstimos, pois rotular erroneamente um possível cliente
   inadimplente como alguém que cumprirá com o empréstimo pode ter implicações mais graves.

Os resultados a seguir vão identificar melhor como foi o processo preditivo dos dois modelos no conjunto de teste.

\begin{table}[H]
  \centering
  \begin{tabular}{lcc}
    \hline
    \textbf{Métricas} & \textbf{Regressão logística} & \textbf{Rede neural} \\
    \hline
    Precisão (Classe 0) & 0.928081                     & \cellcolor{green!25}0.954 \\
    Precisão (Classe 1) & \cellcolor{green!25}0.536334 & 0.291 \\
    Recall   (Classe 0) & \cellcolor{green!25}0.995603 & 0.904 \\
    Recall   (Classe 1) & 0.0618419                    & \cellcolor{green!25}0.478 \\
    F1-Score (Classe 0) & \cellcolor{green!25} 0.960657  & 0.929 \\
    F1-Score (Classe 1) & 0.110897                     & \cellcolor{green!25}0.362 \\
    Acurácia            & \cellcolor{green!25}0.924649   & 0.872 \\
    \hline
  \end{tabular}
  \caption{Comparação dos resultados da Regressão logística e Rede neural. Em verde, o modelo que obteve o melhor resultado na respectiva métrica.}
  \label{tab:comparison_results}
\end{table}



Ao examinar a Tabela \ref{tab:comparison_results}, fica claro que a regressão logística superou a
rede neural em quatro categorias. No entanto, é crucial compreender que esse desempenho destacado
da regressão logística decorre da sua falta de generalização. Este modelo, ao ser treinado
com dados desbalanceados, enfrenta limitações devido à sua arquitetura menos complexa.
Isso ressalta a necessidade de equilibrar a simplicidade do modelo com a capacidade de
generalização para obter resultados mais confiáveis.


Ao avaliar as métricas críticas no contexto de empréstimos, como o Recall da classe 1 e, consequentemente, 
o F1-score dessa classe, destaca-se que a rede neural supera a regressão logística. Notavelmente, 
o recall na rede neural é 40\% superior, evidenciando uma performance mais robusta no que diz respeito 
à identificação de empréstimos ruins.



\begin{table}[H]
\centering
\begin{tabular}{lcc}
  \hline
  \textbf{Covariáveis}               &   \parbox{4cm}{\centering\textbf{Coeficientes da \\ regressão logística}} &  
  \parbox{5cm}{ \centering\textbf{Médias absoluta \\ dos valores de SHAP}} \\
  \hline
   Total líquido pago    &         -4.733 & 0.23363 \\
   Total bruto pago      &          3.321 & 0.22619 \\
   Valor do empréstimo   &         -1.406 & 0.06298 \\
   Renda anual           &         -0.195 & 0.06132 \\
   Tempo de trabalho &         -0.061 & 0.03105 \\
   Parcela               &         0.005 & 0.02586 \\
   DTI                   &         -0.151 & 0.00242 \\
   Taxa de juros         &          1.412 & 0.00232 \\
   Risco                  &         -1.049 & 0.00169 \\
   Duração do empréstimo &          0.033 & 0.00166 \\
   Tipo de moradia       &         0.019 & 0.00117 \\
   Finalidade            &         0.019 & 0.00094 \\
   Tipo de juros        &         -0.462 & 0.00077 \\
   Região                &          0.038 & 0.00071 \\
   Prazo                 &         -0.203 & 0.00068 \\
   Renda categorizada    &         -0.111 & 0.00058 \\
   Tipo da aplicação     &         1.848 & 0       \\
  \hline
  \end{tabular}
  \caption{Relação entre os coeficientes da regressão logística com os valores absolutos de shap}
  \label{tab:coef_vs_shap}
\end{table}

A Tabela \ref{tab:coef_vs_shap} realiza uma comparação entre os coeficientes do modelo logístico
 e a média dos valores absolutos de SHAP, sendo esse último calculado com base em uma amostra composta por 80 observações. 
 A média dos valores de SHAP proporciona uma medida da magnitude das contribuições das variáveis, apresentando, de certa forma, uma analogia com os coeficientes da regressão logística.


 Ambos os modelos exibiram semelhança nas duas variáveis que mais impactam o resultado final.
  No entanto, ao classificar as demais variáveis em ordem de importância,
  observa-se uma divergência significativa no grau de influência que esses valores exercem.

\subsubsection{Tempo de execução}


Examinar o tempo de predição é crucial para alcançar resultados mais rápidos, 
sendo em alguns contextos um fator de extrema relevância, quase tão significativo
 quanto as métricas de desempenho do modelo.

\begin{table}[H]
\centering
\begin{tabular}{lcc}
  \hline
  \textbf{Estatísticas} & \textbf{Regressão logística} & \textbf{Rede neural} \\
  \hline
  Mínimo & 0.0 & 52.067995 \\
  Quartil 25 & 0.0 & 53.327155 \\
  Média & 0.3335619 & 59.446688 \\
  Mediana & 0.0 & 56.855202 \\
  Quartil 75 & 0.88143349 & 66.278052 \\
  Máximo & 1.50370598 & 92.03124 \\
  Variância & 0.28385463 & 59.008917 \\
  Desvio padrão & 0.5327801 & 7.681726 \\
  \hline
\end{tabular}
\caption{Tempo de predição (em ms) de cada modelo, em uma amostra com 50 observações. }
\label{tab:bench_models}
\end{table}

A Tabela \ref{tab:bench_models} destaca a extrema eficiência do modelo logístico
 em comparação com o modelo de redes neurais. O modelo logístico demonstrou um tempo 
 de predição mais curto, com a predição mais demorada levando apenas 1,5 milissegundos,
  sendo mais de 60 vezes mais rápido do que a predição mais demorada do modelo de redes neurais.
   Essa tendência é consistente em relação às outras métricas de desempenho.

\begin{table}[H]
\centering
\begin{tabular}{lc}
\hline
\textbf{Observações} & \textbf{Tempo de execução} \\
\hline
1  & 317s \\
80 & 7.07hrs \\
\hline
\end{tabular}
\caption{Tempo de execução para realizar a interpretação das variáveis}
\label{tab:tempo_execucao_shap}
\end{table}
\newpage


Ao contrário do modelo logístico, onde não há um tempo de execução associado à interpretação, 
pois a interpretação é derivada dos coeficientes estimados, a situação é diferente no modelo de redes neurais. 
A interpretação de uma única observação demandou mais de 5 minutos, e o cálculo das interpretações para as 80
observações utilizadas nos resultados anteriores exigiu mais de 7 horas. Essa diferença substancial de tempo
destaca a complexidade computacional envolvida na interpretação de modelos mais intricados, como redes neurais.

% \centering
% \begin{tabular}{lcccccc}
%   & \textbf{coef} & \textbf{std err} & \textbf{z} & \textbf{P$> |$z$|$} & \textbf{[0.025} & \textbf{0.975]}  \\
% \midrule
% \textbf{duracao\_emprestimo}       &      -0.0606  &        0.005     &   -12.360  &         0.000        &       -0.070    &       -0.051     \\
% \textbf{propriedade\_casa}         &       0.0194  &        0.003     &     7.241  &         0.000        &        0.014    &        0.025     \\
% \textbf{categoria\_renda}          &      -0.1112  &        0.015     &    -7.218  &         0.000        &       -0.141    &       -0.081     \\
% \textbf{renda\_anual}              &      -0.1958  &        0.010     &   -20.148  &         0.000        &       -0.215    &       -0.177     \\
% \textbf{quantidade\_emprestimo}    &      -1.4063  &        0.039     &   -36.171  &         0.000        &       -1.483    &       -1.330     \\
% \textbf{prazo}                     &      -0.2033  &        0.028     &    -7.359  &         0.000        &       -0.257    &       -0.149     \\
% \textbf{tipo\_aplicacao}           &      -1.8479  &        0.106     &   -17.427  &         0.000        &       -2.056    &       -1.640     \\
% \textbf{finalidade}                &       0.0186  &        0.002     &     9.529  &         0.000        &        0.015    &        0.022     \\
% \textbf{pagamentos\_juros}         &      -0.4619  &        0.016     &   -29.243  &         0.000        &       -0.493    &       -0.431     \\
% \textbf{taxa\_juros}               &       1.4125  &        0.020     &    72.213  &         0.000        &        1.374    &        1.451     \\
% \textbf{grau}                      &      -1.0490  &        0.014     &   -76.099  &         0.000        &       -1.076    &       -1.022     \\
% \textbf{dti}                       &      -0.1505  &        0.011     &   -13.463  &         0.000        &       -0.172    &       -0.129     \\
% \textbf{pagamento\_bruto}          &       3.3207  &        0.028     &   118.072  &         0.000        &        3.266    &        3.376     \\
% \textbf{pagamento\_liquido}        &      -4.7329  &        0.034     &  -138.111  &         0.000        &       -4.800    &       -4.666     \\
% \textbf{parcela}                   &       0.0057  &        0.000     &    40.149  &         0.000        &        0.005    &        0.006     \\
% \textbf{regiao}                    &       0.0378  &        0.003     &    11.203  &         0.000        &        0.031    &        0.044     \\
% \textbf{duracao\_emprestimo\_dias} &       0.0326  &        0.009     &     3.704  &         0.000        &        0.015    &        0.050     \\
% \bottomrule
% \end{tabular}